name: Trigger Package Build

on:
  push:
    tags:
      - 'v[0-9]+.[0-9]+.[0-9]+'
      - 'v[0-9]+.[0-9]+.[0-9]+-rc[0-9]+'

jobs:
  dispatch:
    strategy:
        matrix:
            repo: ['siafoundation/homebrew-sia', 'siafoundation/linux']
    runs-on: ubuntu-latest
    steps:
      - name: Extract Tag Name
        id: get_tag
        run: echo "::set-output name=tag_name::${GITHUB_REF#refs/tags/}"

      - name: Repository Dispatch
        uses: peter-evans/repository-dispatch@v2
        with:
          token: ${{ secrets.PAT_REPOSITORY_DISPATCH }}
          repository: ${{ matrix.repo }}
          event-type: release-tagged
          client-payload: '{"tag": "${{ steps.get_tag.outputs.tag_name }}", "project": "renterd"}'